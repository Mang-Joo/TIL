# 지식 탐구

개발자가 도메인 모델을 설계하기 위해선 도메인 전문가와 끝 없는 소통을 통해서 모델을 설계하게 된다.

다이어그램을 그린 후 도메인 전문가와 또 소통하며 잘못된 부분을 해결해나가며 함께 조금씩 모델을 발전시켜 나간다.

## 효과적인 모델링의 요소

1. **모델과 구현의 연계**
2. **모델을 기반으로 하는 언어 정제.**\
   처음에는 전문가가 개발자에게 기초적인 문제를 설명해야했고, 개발자 또한 클래스 다이어그램이 뜻하는 바를 설명해야 했다. 하지만 프로젝트가 진행되면서 누구라도 모델에서 바로 용어를 끄집어내며 모델의 구조와 일관되게 문장을 구성할 수 있게 됐고 별도의 해석 없이도 문장을 이해할 수 있다.
3. **풍부한 지식이 담긴 모델 개발**\
   객체는 행위를 지니고 규칙을 이행한다. 모델은 단순히 데이터 스키마가 아니라 복잡한 문제를 해결하는 데 필수불가결한 것이다.
4. 모델의 정제\
   모델이 점차 완전해지면서 중요한 개념이 더해졌으며, 마찬가지로 쓸모없는 것들은 제거된다는 점 또한 중요하다.
5. 브레인스토밍과 실험\
   스케치를 비롯해 브레인스토밍을 하려는 태도와 결합된 언어를 바탕으로 토의를 모델에 대한 실험실로 변모시켜 실험용 변종을 연습하고, 시도해 보며, 평가할 수 있었다.\
   팀에서 시나리오를 검토할 때 시나이로를 말로 표현해보기만 해도 제안된 모델의 타당성 여부를 재빨리 판단할 수 있었는데, 이는 우리가 뭔가를 듣기만 해도 그러한 표현이 명확하고 쉬운지, 아니면 어색한지 감지해 낼 수 있기 때문이다.

## 지식 탐구

프로젝트에서 반복 프로세스를 활용하지만 추상화를 하지 않는 까닭에 지식을 축적하는 데 실패한다.\
개발자들은 원하는 기능을 전문가가 기술하게 한 다음 그 기능을 구현하기 시작한다.\
결과물을 전문가에게 보여주고, 다음으로 해야 할 일을 묻는다.\
프로그래머가 리팩터링을 하면서 개발한다면 소프트웨어는 계속 확장이 가능한 상태로 유지되겠지만, 프로그래머가 도메인에 관심이 없다면 그 이면에 숨겨진 원리는 알지 못한 채 애플리케이션에서 수행해야 할 사항만 습득한다.

애초부터 추상화를 시작해서 더욱 많은 일을 해낼 수 있는 모델로 발전시킬 것이다.\
하지만 이 같은 과정이 협업 없이 기술적인 측면에서만 일어난다면 개념은 초보적인 수준에 머물 것이다.

모든 구성원이 함께 모델을 면밀히 만들어 나가면 팀 구성원 간의 상호작용은 그 양상을 달리한다.

모델이 점점 향상되면서 모델은 프로젝트 내내 계속해서 흘러가는 정보들을 조직화 하는 도구로 자리잡는다.\
모델은 요구사항 분석에 초점을 맞춘다. 또한 모델은 프로그래밍과 설계와 밀접한 관계를 맺는다. 그리고 모델은 선순환을 통해 도메인에 대한 팀 구성원의 통찰력을 심화시켜 팀 구성원이 더욱 분명하게 모델을 파악하게 하고, 이는 더 높은 수준으로 정제된 모델로 이어진다.

모델은 결코 완벽해질 수 없으며, 계속 발전 해 나갈 뿐이다.\
모델은 도메인을 이해하는 데 실용적이고 유용해야 한다.

여기서 내가 이해한 바는 도메인에 대한 이해 없이 요구사항 대로 기능만 개발하게 된다면, 겉핥기 식으로만 계속 개발하게 되며, 본질적인 문제를 해결할 수 없게 된다. 또한 유지보수도 불가능 할 만큼 복잡해질 것이다.\
이러한 문제가 발생하지 않게 도메인에 대한 지식을 습득하고, 이해하며, 모델링하여 그 문제를 해결해 나가는 연습을 해야겠다.

## 지속적인 학습

소프트웨어를 작성하기 시작할 때 우리는 충분히 알지 못한 상태에서 시작한다.

지속적인 학습을 바탕으로 의식적으로 지식을 함양한다.\
개발자에게는 이것이 일반적인 도메인 모델링 기술과 기술적 지식이 모두 향상된다는 것을 의미한다.\
그 뿐만 아니라 여기엔 현재 종사하는 특정 도메인에 관해 진지하게 학습하는 것도 포함된다.

핵심 모델 요소는 계속 유지 됐지만, 더 중요한 것은 그 다음에 이어지는 작업, 즉 팀 구성원이나 개발자 모두 똑같이 지식을 얻고 의사소통 체계를 공유하며, 구현을 거쳐 피드백 고리를 완성하는 것이다.

도메인 지식은 작을 수도 있고, 정말 평생을 공부할 만큼 클 수도 있다.\
그 도메인에 대해서 꾸준히 공부해야하고, 그렇게 공부하다보면 도메인 모델은 변경될 수 있다.\
우리는 최대한 그 변경점을 적게 하기 위해 조금 더 노력해야하고 더욱 더 좋은 추상화를 해야 할 것이다.

## 풍부한 지식이 담긴 설계

모델에 포착되어 있는 지식은 단순한 "명사 찾기" 이상이다.

나는 이 말이 굉장히 와 닿았다.\
단순히 모델의 명사를 찾아 그것을 모델링 한다면 그것은 소위 말하는 Dto Model 그 이상 그 이하도 아닐 것이라고 생각한다.

우리가 도메인에 대해 공부해야 할 부분은 명사 찾기 뿐만 아니라, 그 명사들이 무슨 역할을 가지고 무슨 일을 하는지 습득하여 그것을 추상화하여 모델링하는 것이다.

예약 어플리케이션이 화물 하나를 기록 관리 하는 것이라고 해보자.

{% code lineNumbers="true" %}
```java
public int makeBooking(Cargo cargo, Voyage voyage) {
    int confirmation = orderConfirmationSequence.next();
    voyage.addCargo(cargo, confirmation);
    return confirmation;
}
```
{% endcode %}

항상 마지막에도 예약을 취소하는 경우가 있으므로 선박이 운항 중에 나를 수 있는 화물의 최대치보다 예약을 더 받아 들이는 것이 도메인의 규칙이다. 이를 "초과예약"이라고 한다.

요구사항에는 다음과 같은 내용이 있다.

**10% 초과예약 허용**

그럼 다음과 같은 코드가 나올 것이다.

```java
public int makeBooking(Cargo cargo, Voyage voyage) {
    double maxBooking = voyage.capacity() * 1.1;
    if((voyage.bookedCargoSize() + cargo.size()) > maxBooking)
        return -1;
    int confirmation = orderConfirmationSequence.next();
    voyage.addCargo(cargo, confirmation);
    return confirmation;
}
```

이제 중요한 업무 규칙이 애플리케이션 메서드의 보호절로 감춰진다.

해당 `* 1.1` 보다 사이즈가 크면 받지 않고 크지 않으면 받는다는 것은 코드를 봤을 때  개발자라면 무슨 코드인지 알 수 있을 것이다.

하지만 다른 개발자가 보았을 때 해당 코드가 규칙이 왜 생긴지 어떠한 규칙인지 한눈에 알 수 있을까?\
혹은 저 조건이 규칙이라는 것으로 받아들일 수 있을까?\
현재는 규칙이 복잡하지 않지만, 복잡한 규칙일 경우 더 이해하기 힘들 것이다.

이러한 것은 설계를 변경해서 깔끔하게 정리할 수 있다.

```java
public int makeBooking(Cargo cargo, Voyage voyage) {
    if(!overBookingPolicy.isAllowed(cargo, voyage))
        return -1;
    int confirmation = orderConfirmationSequence.next();
    voyage.addCargo(cargo, confirmation);
    return confirmation;
}
```

도메인의 모든 세부사항에 이러한 정교한 설계를 적용하라고 권하는 것은 아니다.

중요한 것에만 집중하고 나머지는 축소하거나 분리하는 방법을 깊이 있게 살펴보겠다.

1. 설계를 이러한 수준까지 끌어올리려면 모든 이가 불분명한 계산에 불과한 것이 아니라 별개의 중요한 업무 규칙임을 알아야만 할 것이다.
2. 프로그래머는 업무 전문가에게 그들이 이해할 수 있는 수준에서 기술적 산출물, 심지어 코드까지 보여줄 수 있으며 이로써 피드백 고리도 완성된다.

## 심층 모델

처음엔 나타나기 힘들지만 문제의 **핵심을 관통하는 포착하기 힘든 추상화**가 서서히 나타나기 시작한다.

> 프로젝트에서 화물을 예약하는 행위로 선적이 시작되므로 우리는 화물, 운송 일정 등을 설명해줄 수 있는 모델을 만들었다. 이러한 일들이 모두 필요하고 유용한 것이었지만, 도메인 전문가는 만족스러워하지 않았다.

그 후 도메인 지식 탐구를 통해 화물 취급이나 물리적인 하역 작업, 장소 간 이동과 같은 일은 주로 하도급자나 회사의 운영팀에서 수행한다는 사실을 알게 됐다.\
전문가의 관점에서는 갖가지 책임 이동이 존재한 것이다.

모델이 근본적으로 변하게 되었다.

지식 탐구는 어디서 끝나게 될 지 알  수 없다.

